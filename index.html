<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
</head>
<body class="bg-gray-100 flex flex-col items-center p-6">

  <!-- Upload -->
  <div class="mb-4">
    <input type="file" id="fileInput" accept="application/pdf" class="border p-2">
  </div>

  <!-- Toolbar -->
  <div id="toolbar" class="hidden space-x-4 mb-4">
    <button id="highlightBtn" class="px-4 py-2 bg-yellow-400 rounded">Highlight</button>
    <button id="textBtn" class="px-4 py-2 bg-blue-400 rounded">Add Text</button>
    <button id="drawBtn" class="px-4 py-2 bg-green-400 rounded">Draw</button>
    <button id="downloadBtn" class="px-4 py-2 bg-purple-500 text-white rounded">Download</button>
  </div>

  <!-- PDF Viewer -->
  <div id="pdfViewer" class="w-full max-w-4xl bg-white shadow-md p-4">
    <canvas id="pdfCanvas" class="border"></canvas>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const pdfCanvas = document.getElementById("pdfCanvas");
    const ctx = pdfCanvas.getContext("2d");
    const toolbar = document.getElementById("toolbar");

    let pdfDoc = null;
    let pageNum = 1;

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file && file.type === "application/pdf") {
        const reader = new FileReader();
        reader.onload = function() {
          const typedarray = new Uint8Array(this.result);
          pdfjsLib.getDocument(typedarray).promise.then((pdf) => {
            pdfDoc = pdf;
            renderPage(pageNum);
            toolbar.classList.remove("hidden"); // show edit tools
          });
        };
        reader.readAsArrayBuffer(file);
      }
    });

    function renderPage(num) {
      pdfDoc.getPage(num).then((page) => {
        const viewport = page.getViewport({ scale: 1.5 });
        pdfCanvas.height = viewport.height;
        pdfCanvas.width = viewport.width;

        const renderContext = {
          canvasContext: ctx,
          viewport: viewport,
        };
        page.render(renderContext);
      });
    }

    // --- Editing tools (basic placeholders) ---
    document.getElementById("highlightBtn").addEventListener("click", () => {
      ctx.fillStyle = "rgba(255, 255, 0, 0.5)";
      ctx.fillRect(100, 100, 200, 30); // Example highlight
    });

    document.getElementById("textBtn").addEventListener("click", () => {
      ctx.fillStyle = "blue";
      ctx.font = "20px Arial";
      ctx.fillText("Custom Text", 150, 150); // Example text
    });

    document.getElementById("drawBtn").addEventListener("click", () => {
      ctx.strokeStyle = "red";
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(50, 50);
      ctx.lineTo(200, 200);
      ctx.stroke();
    });

    document.getElementById("downloadBtn").addEventListener("click", () => {
      const link = document.createElement("a");
      link.href = pdfCanvas.toDataURL("image/png");
      link.download = "edited_page.png"; // saves only as image for now
      link.click();
    });
  </script>
</body>
</html>
