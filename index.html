<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Editor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.2.4/fabric.min.js"></script>
</head>
<body class="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-white">

  <h1 class="text-2xl font-bold mb-4">üñäÔ∏è Image Editor (Add Text + Signature)</h1>

  <!-- Controls -->
  <div class="mb-4 flex gap-2">
    <input type="file" id="fileInput" accept="image/*" class="p-2 bg-gray-800 rounded" />
    <button id="addTextBtn" class="px-4 py-2 bg-blue-600 rounded">Add Text</button>
    <button id="enableSignBtn" class="px-4 py-2 bg-green-600 rounded">Enable Sign</button>
    <button id="disableSignBtn" class="px-4 py-2 bg-yellow-600 rounded">Disable Sign</button>
    <button id="saveBtn" class="px-4 py-2 bg-red-600 rounded">Save</button>
  </div>

  <!-- Canvas -->
  <canvas id="canvas" width="800" height="600" class="border border-gray-500 bg-white"></canvas>

  <script>
    const canvas = new fabric.Canvas("canvas", {
      selection: true
    });

    // Upload image
    document.getElementById("fileInput").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (f) => {
        fabric.Image.fromURL(f.target.result, (img) => {
          img.scaleToWidth(canvas.width);
          canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
            scaleX: canvas.width / img.width,
            scaleY: canvas.height / img.height
          });
        });
      };
      reader.readAsDataURL(file);
    });

    // Add text at cursor
    let isAddingText = false;
    document.getElementById("addTextBtn").addEventListener("click", () => {
      isAddingText = true;
      canvas.defaultCursor = "text";
    });

    canvas.on("mouse:down", function (opt) {
      if (!isAddingText) return;
      const pointer = canvas.getPointer(opt.e);
      const text = new fabric.IText("Edit me", {
        left: pointer.x,
        top: pointer.y,
        fontSize: 24,
        fill: "black",
        editable: true
      });
      canvas.add(text).setActiveObject(text);
      canvas.renderAll();
      isAddingText = false;
      canvas.defaultCursor = "default";
    });

    // Enable digital signature
    document.getElementById("enableSignBtn").addEventListener("click", () => {
      canvas.isDrawingMode = true;
      canvas.freeDrawingBrush.width = 3;
      canvas.freeDrawingBrush.color = "black";
    });

    document.getElementById("disableSignBtn").addEventListener("click", () => {
      canvas.isDrawingMode = false;
    });

    // Save final image
    document.getElementById("saveBtn").addEventListener("click", () => {
      const dataURL = canvas.toDataURL({
        format: "png",
        quality: 1
      });
      const link = document.createElement("a");
      link.href = dataURL;
      link.download = "edited-image.png";
      link.click();
    });
  </script>
</body>
</html>
